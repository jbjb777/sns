<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì•Œë¦¼ - Sharer</title>
  <link rel="icon" type="image/svg+xml" href="./logo.svg">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', sans-serif; background: #121212; color: #fff; min-height: 100vh; display: flex; }
    
    .sidebar-container {
      width: 250px;
      min-width: 250px;
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      z-index: 100;
    }

    .sidebar-container iframe {
      width: 250px !important;
      height: 100%;
      border: none;
    }

    .main-wrapper {
      margin-left: 250px;
      width: calc(100% - 250px);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .header {
      background: #1e1e1e;
      border-bottom: 1px solid #333;
      padding: 20px;
      position: sticky;
      top: 0;
      z-index: 50;
    }

    .header-title {
      font-size: 24px;
      font-weight: 600;
      color: #fff;
    }

    .main-content {
      flex: 1;
      display: flex;
      justify-content: center;
      padding: 20px;
      overflow-y: auto;
    }

    .notifications-container {
      max-width: 700px;
      width: 100%;
    }

    .notification-item {
      background: #1e1e1e;
      border: 1px solid #333;
      border-radius: 12px;
      padding: 16px 20px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .notification-item.read {
      opacity: 0.5;
      background: #1a1a1a;
    }

    .notification-item:hover {
      transform: translateY(-2px);
      border-color: #3663FF;
      box-shadow: 0 4px 12px rgba(54, 99, 255, 0.3);
    }

    .notification-detail {
      font-size: 15px;
      line-height: 1.5;
      color: #fff;
      font-weight: 500;
    }

    .notification-time {
      font-size: 13px;
      color: #888;
    }

    .notification-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #3663FF, #2952CC);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
    }

    .notification-header {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .notification-content {
      flex: 1;
    }

    .empty-state {
      text-align: center;
      padding: 80px 20px;
      color: #666;
    }

    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .empty-state-text {
      font-size: 16px;
      color: #888;
    }

    .skeleton {
      background: linear-gradient(90deg, #1e1e1e 25%, #2a2a2a 50%, #1e1e1e 75%);
      background-size: 200% 100%;
      animation: loading 1.5s ease-in-out infinite;
      border-radius: 4px;
    }

    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .skeleton-notification {
      background: #1e1e1e;
      border: 1px solid #333;
      border-radius: 12px;
      padding: 16px 20px;
      margin-bottom: 12px;
      display: flex;
      gap: 12px;
    }

    .skeleton-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }

    .skeleton-content {
      flex: 1;
    }

    .skeleton-text {
      width: 100%;
      height: 16px;
      margin-bottom: 8px;
      border-radius: 4px;
    }

    .skeleton-text.short {
      width: 40%;
    }

    .login-alert {
      position: fixed;
      top: -100px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #3663FF, #2952CC);
      color: white;
      padding: 16px 32px;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(54, 99, 255, 0.4);
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      z-index: 9999;
      transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      display: flex;
      align-items: center;
      gap: 12px;
      border: 2px solid rgba(255, 255, 255, 0.2);
    }

    .login-alert.show {
      top: 20px;
      animation: bounce 0.6s ease;
    }

    .login-alert:hover {
      transform: translateX(-50%) scale(1.05);
      box-shadow: 0 12px 32px rgba(54, 99, 255, 0.6);
    }

    .login-alert-icon {
      font-size: 20px;
      animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateX(-50%) translateY(0); }
      50% { transform: translateX(-50%) translateY(-10px); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.8; transform: scale(1.1); }
    }

    .footer {
      background: #1e1e1e;
      border-top: 1px solid #333;
      padding: 30px 20px;
      text-align: center;
      color: #aaa;
      font-size: 14px;
      margin-top: auto;
    }

    .footer-links {
      margin-bottom: 15px;
    }

    .footer-links a {
      color: #3663FF;
      text-decoration: none;
      margin: 0 15px;
      transition: color 0.3s;
    }

    .footer-links a:hover {
      color: #00aaff;
      text-decoration: underline;
    }

    .footer-text {
      color: #666;
      font-size: 12px;
    }

    @media (max-width: 768px) {
      .sidebar-container { 
        width: 80px; 
        min-width: 80px;
      }
      .sidebar-container iframe {
        width: 80px !important;
      }
      .main-wrapper { 
        margin-left: 80px; 
        width: calc(100% - 80px); 
      }
      .header-title {
        font-size: 20px;
      }
      .login-alert {
        max-width: 90%;
        padding: 14px 24px;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="login-alert" id="loginAlert">
    <span class="login-alert-icon">ğŸ”</span>
    <span>ë¡œê·¸ì¸ í›„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤</span>
  </div>

  <div class="sidebar-container">
    <iframe 
      src="sidebar.html" 
      id="sidebarFrame"
      width="250"
      height="100%"
      frameborder="0"
    ></iframe>
  </div>

  <div class="main-wrapper">
    <div class="header">
      <div class="header-title">ğŸ”” ì•Œë¦¼</div>
    </div>

    <div class="main-content">
      <div class="notifications-container" id="notificationsContainer">
        <!-- ìŠ¤ì¼ˆë ˆí†¤ ë¡œë”© -->
        <div class="skeleton-notification">
          <div class="skeleton skeleton-icon"></div>
          <div class="skeleton-content">
            <div class="skeleton skeleton-text"></div>
            <div class="skeleton skeleton-text short"></div>
          </div>
        </div>
        <div class="skeleton-notification">
          <div class="skeleton skeleton-icon"></div>
          <div class="skeleton-content">
            <div class="skeleton skeleton-text"></div>
            <div class="skeleton skeleton-text short"></div>
          </div>
        </div>
        <div class="skeleton-notification">
          <div class="skeleton skeleton-icon"></div>
          <div class="skeleton-content">
            <div class="skeleton skeleton-text"></div>
            <div class="skeleton skeleton-text short"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">
      <div class="footer-links">
        <a href="#" onclick="showPrivacyPolicy(); return false;">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
        <a href="#" onclick="showTerms(); return false;">ì´ìš©ì•½ê´€</a>
        <a href="mailto:alexeom97@outlook.com">ë¬¸ì˜í•˜ê¸°</a>
      </div>
      <div class="footer-text">
        Â© 2025 ã‹¡ê§ì •ë¹ˆ777ê§‚ SNS. All rights reserved.
      </div>
    </div>
  </div>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
    
    const SUPABASE_URL = "https://hoeevmstbhulbzqyfsug.supabase.co";
    const SUPABASE_PUBLISHABLE_KEY = "sb_publishable_QQCVYix-A8r3vCipAnu0Xg_hST_0xBa";
    
    const supabase = createClient(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY);

    let currentUser = null;

    function showLoginAlert() {
      const alert = document.getElementById('loginAlert');
      alert.classList.add('show');
      
      const hideTimeout = setTimeout(() => {
        alert.classList.remove('show');
      }, 3000);

      alert.onclick = () => {
        clearTimeout(hideTimeout);
        window.location.href = 'login.html';
      };
    }

    function initCurrentUser() {
      const savedUser = localStorage.getItem('snsUser');
      if (savedUser) {
        currentUser = JSON.parse(savedUser);
        updateSidebar();
        loadNotifications();
      } else {
        showLoginAlert();
        setTimeout(() => {
          window.location.href = 'login.html';
        }, 1500);
      }
    }

    function updateSidebar() {
      const iframe = document.getElementById('sidebarFrame');
      if (iframe && iframe.contentWindow) {
        iframe.contentWindow.postMessage({
          type: 'updateUser',
          user: currentUser
        }, '*');
      }
    }

    function updateSidebarMode() {
      const iframe = document.getElementById('sidebarFrame');
      const narrow = window.innerWidth <= 768;
      if (iframe && iframe.contentWindow) {
        iframe.contentWindow.postMessage({
          type: 'setNarrowMode',
          narrow: narrow
        }, '*');
      }
    }

    // ì‚¬ì´ë“œë°” ë©”ì‹œì§€ ìˆ˜ì‹ 
    window.addEventListener('message', (event) => {
      const { type, page } = event.data || {};

      if (type === 'navigate') {
        if (page === 'home') location.href = 'index.html';
        if (page === 'explore') location.href = 'explore.html';
        if (page === 'notifications') location.href = 'notifications.html';
      }

      if (type === 'logout') {
        localStorage.removeItem('snsUser');
        currentUser = null;
        location.href = 'index.html';
      }

      if (type === 'requestUserInfo') {
        updateSidebar();
      }
    });

    async function loadNotifications() {
      if (!currentUser) return;

      const container = document.getElementById('notificationsContainer');

      try {
        const { data: notifications, error } = await supabase
          .from('notification')
          .select('*')
          .eq('user', currentUser.id)
          .order('created_at', { ascending: false });

        if (error) throw error;

        if (!notifications || notifications.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">ğŸ”•</div>
              <div class="empty-state-text">ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
          `;
          return;
        }

        container.innerHTML = '';

        notifications.forEach(notification => {
          const notifDiv = document.createElement('div');
          notifDiv.className = 'notification-item';
          
          // isread íƒ€ì… ë³€í™˜ í›„ ë¹„êµ (ë¬¸ìì—´ "2"ì™€ ìˆ«ì 2 ë‘˜ ë‹¤ ì²˜ë¦¬)
          if (Number(notification.isread) === 2) {
            notifDiv.classList.add('read');
          }
          
          const timeStr = formatTime(notification.created_at);
          const icon = getNotificationIcon(notification.detail);

          notifDiv.innerHTML = `
            <div class="notification-header">
              <div class="notification-icon">${icon}</div>
              <div class="notification-content">
                <div class="notification-detail">${escapeHtml(notification.detail)}</div>
                <div class="notification-time">${timeStr}</div>
              </div>
            </div>
          `;

          notifDiv.onclick = async () => {
            // isreadê°€ 1ì¼ ë•Œë§Œ 2ë¡œ ì—…ë°ì´íŠ¸
            if (Number(notification.isread) === 1) {
              // ì¦‰ì‹œ í™”ë©´ì— íˆ¬ëª…ë„ ì ìš© (UX ê°œì„ )
              notifDiv.classList.add('read');
              notification.isread = 2;

              try {
                const { error } = await supabase
                  .from('notification')
                  .update({ isread: 2 })
                  .eq('id', notification.id);
                
                if (error) {
                  console.error('ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
                  // ì‹¤íŒ¨ ì‹œ ì›ë˜ëŒ€ë¡œ ë³µêµ¬
                  notifDiv.classList.remove('read');
                  notification.isread = 1;
                }
              } catch (error) {
                console.error('ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                // ì‹¤íŒ¨ ì‹œ ì›ë˜ëŒ€ë¡œ ë³µêµ¬
                notifDiv.classList.remove('read');
                notification.isread = 1;
              }
            }
            
            // ë§í¬ë¡œ ì´ë™
            if (notification.link) {
              window.location.href = notification.link;
            }
          };

          container.appendChild(notifDiv);
        });

      } catch (error) {
        console.error('ì•Œë¦¼ ë¡œë“œ ì˜¤ë¥˜:', error);
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">âš ï¸</div>
            <div class="empty-state-text">ì•Œë¦¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</div>
          </div>
        `;
      }
    }

    function getNotificationIcon(detail) {
      if (!detail) return 'ğŸ””';
      
      const lowerDetail = detail.toLowerCase();
      
      if (lowerDetail.includes('ëŒ“ê¸€')) return 'ğŸ’¬';
      if (lowerDetail.includes('ì¢‹ì•„ìš”')) return 'â¤ï¸';
      if (lowerDetail.includes('íŒ”ë¡œìš°')) return 'ğŸ‘¤';
      if (lowerDetail.includes('ê²Œì‹œë¬¼')) return 'ğŸ“';
      if (lowerDetail.includes('ë©˜ì…˜') || lowerDetail.includes('@')) return 'ğŸ“¢';
      
      return 'ğŸ””';
    }

    function formatTime(dateString) {
      const date = new Date(dateString);
      const now = new Date();
      const diffMs = now - date;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMs / 3600000);
      const diffDays = Math.floor(diffMs / 86400000);

      if (diffMins < 1) return 'ë°©ê¸ˆ ì „';
      if (diffMins < 60) return `${diffMins}ë¶„ ì „`;
      if (diffHours < 24) return `${diffHours}ì‹œê°„ ì „`;
      if (diffDays < 7) return `${diffDays}ì¼ ì „`;
      
      return date.toLocaleDateString('ko-KR', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
    }

    function escapeHtml(text) {
      if (!text) return '';
      const map = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#039;'
      };
      return text.replace(/[&<>"']/g, m => map[m]);
    }

    window.showPrivacyPolicy = function() {
      alert(`ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨

ã‹¡ê§ì •ë¹ˆ777ê§‚ SNSëŠ” ì´ìš©ìì˜ ê°œì¸ì •ë³´ë¥¼ ì¤‘ìš”ì‹œí•˜ë©°, "ê°œì¸ì •ë³´ ë³´í˜¸ë²•"ì„ ì¤€ìˆ˜í•˜ê³  ìˆìŠµë‹ˆë‹¤.

1. ìˆ˜ì§‘í•˜ëŠ” ê°œì¸ì •ë³´ í•­ëª©
- í•„ìˆ˜í•­ëª©: ì•„ì´ë””, ë¹„ë°€ë²ˆí˜¸, ë‹‰ë„¤ì„

2. ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘ ë° ì´ìš©ëª©ì 
- íšŒì› ê´€ë¦¬, ì„œë¹„ìŠ¤ ì œê³µ, ê²Œì‹œë¬¼ ê´€ë¦¬

3. ê°œì¸ì •ë³´ì˜ ë³´ìœ  ë° ì´ìš©ê¸°ê°„
- íšŒì› íƒˆí‡´ ì‹œê¹Œì§€

4. ê°œì¸ì •ë³´ íŒŒê¸°ì ˆì°¨ ë° ë°©ë²•
- ì´ìš©ìì˜ ê°œì¸ì •ë³´ëŠ” ì›ì¹™ì ìœ¼ë¡œ ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘ ë° ì´ìš©ëª©ì ì´ ë‹¬ì„±ë˜ë©´ ì§€ì²´ ì—†ì´ íŒŒê¸°í•©ë‹ˆë‹¤.

5. ì´ìš©ìì˜ ê¶Œë¦¬
- ì´ìš©ìëŠ” ì–¸ì œë“ ì§€ ë³¸ì¸ì˜ ê°œì¸ì •ë³´ë¥¼ ì¡°íšŒí•˜ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë¬¸ì˜ì‚¬í•­: alexeom97@outlook.com`);
    }

    window.showTerms = function() {
      alert(`ì´ìš©ì•½ê´€

ì œ1ì¡° (ëª©ì )
ì´ ì•½ê´€ì€ ã‹¡ê§ì •ë¹ˆ777ê§‚ SNS ì„œë¹„ìŠ¤ì˜ ì´ìš©ì¡°ê±´ ë° ì ˆì°¨ì— ê´€í•œ ì‚¬í•­ì„ ê·œì •í•¨ì„ ëª©ì ìœ¼ë¡œ í•©ë‹ˆë‹¤.

ì œ2ì¡° (ìš©ì–´ì˜ ì •ì˜)
1. "ì„œë¹„ìŠ¤"ë€ ã‹¡ê§ì •ë¹ˆ777ê§‚ SNSê°€ ì œê³µí•˜ëŠ” ëª¨ë“  ì„œë¹„ìŠ¤ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.
2. "íšŒì›"ì´ë€ ì„œë¹„ìŠ¤ì— ì ‘ì†í•˜ì—¬ ì´ ì•½ê´€ì— ë”°ë¼ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” ìë¥¼ ë§í•©ë‹ˆë‹¤.

ì œ3ì¡° (ì„œë¹„ìŠ¤ì˜ ì œê³µ)
1. ì„œë¹„ìŠ¤ëŠ” ì—°ì¤‘ë¬´íœ´, 1ì¼ 24ì‹œê°„ ì œê³µí•¨ì„ ì›ì¹™ìœ¼ë¡œ í•©ë‹ˆë‹¤.
2. ì„œë¹„ìŠ¤ëŠ” ì‹œìŠ¤í…œ ì ê²€ ë“± í•„ìš”í•œ ê²½ìš° ì¼ì‹œì ìœ¼ë¡œ ì¤‘ë‹¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì œ4ì¡° (íšŒì›ì˜ ì˜ë¬´)
1. íšŒì›ì€ ê´€ê³„ë²•ë ¹, ì´ ì•½ê´€ì˜ ê·œì •, ì´ìš©ì•ˆë‚´ ë° ì„œë¹„ìŠ¤ì™€ ê´€ë ¨í•˜ì—¬ ê³µì§€í•œ ì£¼ì˜ì‚¬í•­ì„ ì¤€ìˆ˜í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.
2. íšŒì›ì€ íƒ€ì¸ì˜ ëª…ì˜ˆë¥¼ ì†ìƒì‹œí‚¤ê±°ë‚˜ ë¶ˆì´ìµì„ ì£¼ëŠ” í–‰ìœ„ë¥¼ í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.

ì œ5ì¡° (ì„œë¹„ìŠ¤ ì´ìš©ì˜ ì œí•œ)
ìš´ì˜ìëŠ” íšŒì›ì´ ì´ ì•½ê´€ì˜ ì˜ë¬´ë¥¼ ìœ„ë°˜í•˜ê±°ë‚˜ ì„œë¹„ìŠ¤ì˜ ì •ìƒì ì¸ ìš´ì˜ì„ ë°©í•´í•œ ê²½ìš°, ì„œë¹„ìŠ¤ ì´ìš©ì„ ì œí•œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë¬¸ì˜ì‚¬í•­: alexeom97@outlook.com`);
    }

    initCurrentUser();
    updateSidebarMode();
    window.addEventListener('resize', updateSidebarMode);
  </script>
</body>
</html>
